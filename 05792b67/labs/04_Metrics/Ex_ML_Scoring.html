<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>MLBA - S24  – ex_ml_scoring</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../labs/05_DataSplitting/Ex_ML_Data_Splitting.html" rel="next">
<link href="../../labs/03_Models/034_SupportVectorMachine/Ex_ML_SVM.html" rel="prev">
<link href="../../images/logo.dark.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar docked">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/logo.light.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
      <div class="sidebar-tools-main tools-wide">
    <a href="http://moodle2.unil.ch/course/view.php?id=8715" title="Moodle" class="sidebar-tool px-1"><i class="bi bi-person-rolodex"></i></a>
    <a href="https://github.com/do-unil/mlba" title="GitHub Repo" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">Course information</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">Overview</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../schedule.html" class="sidebar-item-text sidebar-link">Schedule</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../faq.html" class="sidebar-item-text sidebar-link">FAQ</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">Lectures</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/01_Introduction/ML_Intro.html" class="sidebar-item-text sidebar-link">Intro to ML</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/02_DataExploration/ML_DataExplo.html" class="sidebar-item-text sidebar-link">Data Exploration</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/03_Models/030_Introduction/ML_Models_Intro.html" class="sidebar-item-text sidebar-link">Intro to Models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/03_Models/031_LinearLogisticRegression/ML_LinLogReg.html" class="sidebar-item-text sidebar-link">Linear &amp; Logistic Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/03_Models/032_Trees/ML_Trees.html" class="sidebar-item-text sidebar-link">Decision Trees</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/03_Models/033_NeuralNetworks/ML_NN.html" class="sidebar-item-text sidebar-link">Neural Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/03_Models/034_SupportVectorMachine/ML_SVM.html" class="sidebar-item-text sidebar-link">Support Vector Machines</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/04_Metrics/ML_Metrics.html" class="sidebar-item-text sidebar-link">Metrics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/05_DataSplitting/ML_DataSplitting.html" class="sidebar-item-text sidebar-link">Data Splitting</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/06_Ensembles/ML_Ensemble.html" class="sidebar-item-text sidebar-link">Ensemble Methods</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/07_InterpretableML/ML_Interp.html" class="sidebar-item-text sidebar-link">Interpretable ML</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/08_UnsupervisedLearning/080_Introduction/ML_UnsupIntro.html" class="sidebar-item-text sidebar-link">Intro to Unsuperised Learning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/08_UnsupervisedLearning/081_Clustering/ML_Clustering.html" class="sidebar-item-text sidebar-link">Clustering</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/08_UnsupervisedLearning/082_DimensionReduction/ML_DimRed.html" class="sidebar-item-text sidebar-link">Dimension Reduction</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Labs</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../labs/00_lab/setup.html" class="sidebar-item-text sidebar-link">Setup</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../labs/03_Models/031_LinearLogisticRegression/Ex_ML_LinLogReg.html" class="sidebar-item-text sidebar-link">Linear &amp; Logistic Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../labs/03_Models/032_Trees/Ex_ML_Tree.html" class="sidebar-item-text sidebar-link">Decision Trees</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../labs/03_Models/033_NeuralNetworks/EX_ML_NN.html" class="sidebar-item-text sidebar-link">Neural Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../labs/03_Models/034_SupportVectorMachine/Ex_ML_SVM.html" class="sidebar-item-text sidebar-link">Support Vector Machines</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../labs/04_Metrics/Ex_ML_Scoring.html" class="sidebar-item-text sidebar-link active">Metrics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../labs/05_DataSplitting/Ex_ML_Data_Splitting.html" class="sidebar-item-text sidebar-link">Data Splitting</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../labs/06_Ensembles/Ex_ML_Ensemble.html" class="sidebar-item-text sidebar-link">Ensemble Methods</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../labs/07_InterpretableML/Ex_ML_VarImp.html" class="sidebar-item-text sidebar-link">Interpretable ML</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../labs/08_UnsupervisedLearning/081_Clustering/Ex_ML_Clustering.html" class="sidebar-item-text sidebar-link">Clustering</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../labs/08_UnsupervisedLearning/082_DimensionReduction/Ex_ML_PCA.html" class="sidebar-item-text sidebar-link">PCA</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../labs/08_UnsupervisedLearning/083_AutoEncoders/Ex_ML_Autoencoder.html" class="sidebar-item-text sidebar-link">Autoencoders</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">Assessments</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../assessments/Exam.html" class="sidebar-item-text sidebar-link">Exam</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">Project</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../assessments/Project_Directives.html" class="sidebar-item-text sidebar-link">Project Directives</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../assessments/Report_Guideline.html" class="sidebar-item-text sidebar-link">Report Guidelines</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../assessments/Presentation_Guidelines.html" class="sidebar-item-text sidebar-link">Presentation Guidelines</a>
  </div>
</li>
      </ul>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">Resources</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/beginners_r.html" class="sidebar-item-text sidebar-link">Beginners in R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/data_acquisition/data_sources.html" class="sidebar-item-text sidebar-link">Data Sources</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/data_acquisition/web_scraping_api.html" class="sidebar-item-text sidebar-link">Web Scraping</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/cheatsheets.html" class="sidebar-item-text sidebar-link">Coding Cheatsheets</a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#regression-task" id="toc-regression-task" class="nav-link active" data-scroll-target="#regression-task">Regression task</a>
  <ul class="collapse">
<li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#models" id="toc-models" class="nav-link" data-scroll-target="#models">Models</a></li>
  <li><a href="#r-squared" id="toc-r-squared" class="nav-link" data-scroll-target="#r-squared">R-squared</a></li>
  <li><a href="#rmse" id="toc-rmse" class="nav-link" data-scroll-target="#rmse">RMSE</a></li>
  <li><a href="#mae" id="toc-mae" class="nav-link" data-scroll-target="#mae">MAE</a></li>
  <li><a href="#best-model" id="toc-best-model" class="nav-link" data-scroll-target="#best-model">Best model</a></li>
  </ul>
</li>
  <li>
<a href="#classification-task" id="toc-classification-task" class="nav-link" data-scroll-target="#classification-task">Classification task</a>
  <ul class="collapse">
<li><a href="#data-1" id="toc-data-1" class="nav-link" data-scroll-target="#data-1">Data</a></li>
  <li><a href="#models-1" id="toc-models-1" class="nav-link" data-scroll-target="#models-1">Models</a></li>
  <li><a href="#predictions" id="toc-predictions" class="nav-link" data-scroll-target="#predictions">Predictions</a></li>
  <li><a href="#confusion-matrices-prediction-based-measures" id="toc-confusion-matrices-prediction-based-measures" class="nav-link" data-scroll-target="#confusion-matrices-prediction-based-measures">Confusion matrices &amp; prediction-based measures</a></li>
  <li><a href="#probability-based-measures" id="toc-probability-based-measures" class="nav-link" data-scroll-target="#probability-based-measures">Probability-based measures</a></li>
  <li><a href="#roc-curve-prob-threshold-tuning" id="toc-roc-curve-prob-threshold-tuning" class="nav-link" data-scroll-target="#roc-curve-prob-threshold-tuning">ROC curve &amp; prob threshold tuning</a></li>
  </ul>
</li>
  <li>
<a href="#your-turn" id="toc-your-turn" class="nav-link" data-scroll-target="#your-turn">Your turn</a>
  <ul class="collapse">
<li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification">Classification</a></li>
  <li><a href="#regression" id="toc-regression" class="nav-link" data-scroll-target="#regression">Regression</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/do-unil/mlba/blob/main/labs/04_Metrics/Ex_ML_Scoring.qmd" class="toc-action">View source</a></p><p><a href="https://github.com/do-unil/mlba/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><script type="application/javascript">
// Description: Change image src depending on body class (quarto-light or quarto-dark)
function updateImageSrc() {
  var bodyClass = window.document.body.classList;
  var images = window.document.getElementsByTagName('img');
  for (var i = 0; i < images.length; i++) {
    var image = images[i];
    var src = image.src;
    var newSrc = src;
    if (bodyClass.contains('quarto-light') && src.includes('.dark')) {
      newSrc = src.replace('.dark', '.light');
    } else if (bodyClass.contains('quarto-dark') && src.includes('.light')) {
      newSrc = src.replace('.light', '.dark');
    }
    if (newSrc !== src) {
      image.src = newSrc;
    }
  }
}

var observer = new MutationObserver(function(mutations) {
  mutations.forEach(function(mutation) {
    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
      updateImageSrc();
    }
  });
});

observer.observe(window.document.body, {
  attributes: true
});

updateImageSrc();
</script><p>How can I render the following?— title: “Model scoring”</p>
<hr>
<section id="regression-task" class="level1"><h1>Regression task</h1>
<section id="data" class="level2"><h2 class="anchored" data-anchor-id="data">Data</h2>
<p>The data set is the one used in the series on linear regressions.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="va">real_estate_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"labs/data/real_estate_data.csv"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we split the data in a training and a test set (0.8/0.2). For this, we use the <code>createDataPartition</code> function of the <code>caret</code> package.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">234</span><span class="op">)</span></span>
<span><span class="va">index_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">real_estate_data</span><span class="op">$</span><span class="va">Price</span>, p<span class="op">=</span> <span class="fl">0.8</span>, list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">df_tr</span> <span class="op">&lt;-</span> <span class="va">real_estate_data</span><span class="op">[</span><span class="va">index_tr</span>,<span class="op">]</span></span>
<span><span class="va">df_te</span> <span class="op">&lt;-</span> <span class="va">real_estate_data</span><span class="op">[</span><span class="op">-</span><span class="va">index_tr</span>,<span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="models" class="level2"><h2 class="anchored" data-anchor-id="models">Models</h2>
<p>We will compare a linear regression, a regression tree and a 3-NN (KNN).</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart">rpart</a></span><span class="op">)</span></span>
<span><span class="va">est_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Price</span><span class="op">~</span><span class="va">TransDate</span><span class="op">+</span><span class="va">HouseAge</span><span class="op">+</span><span class="va">Dist</span><span class="op">+</span></span>
<span>               <span class="va">NumStores</span><span class="op">+</span><span class="va">Lat</span><span class="op">+</span><span class="va">Long</span>, data<span class="op">=</span><span class="va">df_tr</span><span class="op">)</span></span>
<span><span class="va">est_rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart</a></span><span class="op">(</span><span class="va">Price</span><span class="op">~</span><span class="va">TransDate</span><span class="op">+</span><span class="va">HouseAge</span><span class="op">+</span><span class="va">Dist</span><span class="op">+</span></span>
<span>                      <span class="va">NumStores</span><span class="op">+</span><span class="va">Lat</span><span class="op">+</span><span class="va">Long</span>, data<span class="op">=</span><span class="va">df_tr</span><span class="op">)</span></span>
<span><span class="va">est_knn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/knnreg.html">knnreg</a></span><span class="op">(</span><span class="va">Price</span><span class="op">~</span><span class="va">TransDate</span><span class="op">+</span><span class="va">HouseAge</span><span class="op">+</span><span class="va">Dist</span><span class="op">+</span></span>
<span>                      <span class="va">NumStores</span><span class="op">+</span><span class="va">Lat</span><span class="op">+</span><span class="va">Long</span>, data<span class="op">=</span><span class="va">df_tr</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load the course python environment as usual with a r code chunks.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/">reticulate</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html">use_condaenv</a></span><span class="op">(</span><span class="st">"MLBA"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the models: linear regression, regression tree, and KNN</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define predictors and target variable</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">'TransDate'</span>, <span class="st">'HouseAge'</span>, <span class="st">'Dist'</span>, <span class="st">'NumStores'</span>, <span class="st">'Lat'</span>, <span class="st">'Long'</span>]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> <span class="st">'Price'</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>est_lm <span class="op">=</span> LinearRegression().fit(r.df_tr[predictors], r.df_tr[target])</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>est_rt <span class="op">=</span> DecisionTreeRegressor(random_state<span class="op">=</span><span class="dv">234</span>).fit(r.df_tr[predictors], r.df_tr[target])</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>est_knn <span class="op">=</span> KNeighborsRegressor(n_neighbors<span class="op">=</span><span class="dv">3</span>).fit(r.df_tr[predictors], r.df_tr[target])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><section id="r-squared" class="level2"><h2 class="anchored" data-anchor-id="r-squared">R-squared</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>We now compute the R2 for each model using the <code>R2</code> function (in <code>caret</code>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">R2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_lm</span>, newdata <span class="op">=</span> <span class="va">df_te</span><span class="op">)</span>, <span class="va">df_te</span><span class="op">$</span><span class="va">Price</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">R2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_rt</span>, newdata <span class="op">=</span> <span class="va">df_te</span><span class="op">)</span>, <span class="va">df_te</span><span class="op">$</span><span class="va">Price</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">R2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_knn</span>, newdata <span class="op">=</span> <span class="va">df_te</span><span class="op">)</span>, <span class="va">df_te</span><span class="op">$</span><span class="va">Price</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Just for the exercise, we can compute it by hand (square of the correlation)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_lm</span>, newdata <span class="op">=</span> <span class="va">df_te</span><span class="op">)</span>, <span class="va">df_te</span><span class="op">$</span><span class="va">Price</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Same thing as the R code</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Only to demonostrate which argument goes where (different from `caret::R2`)</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r2_score(y_true <span class="op">=</span> r.df_te[target], y_pred <span class="op">=</span> est_lm.predict(r.df_te[predictors])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r2_score(r.df_te[target], est_rt.predict(r.df_te[predictors])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r2_score(r.df_te[target], est_knn.predict(r.df_te[predictors])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing it by hand gives us the same result as R</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>np.corrcoef(est_lm.predict(r.df_te[predictors]), r.df_te[target])[<span class="dv">0</span>][<span class="dv">1</span>]<span class="op">**</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To understand why the results are different in <code><a href="https://rdrr.io/pkg/caret/man/postResample.html">caret::R2()</a></code> vs.&nbsp;<code>sklearn.metrics.r2_score()</code>, see <a href="https://stats.stackexchange.com/questions/586821/what-is-the-interpretation-of-the-traditional-r2">this post on stackoverflow</a>. If you want to get the same results in both, you can set the argument <code>form = 'corr'</code> to <code>form = "traditional"</code> in <code><a href="https://rdrr.io/pkg/caret/man/postResample.html">caret::R2()</a></code> so that for instance <code>R2(predict(est_lm, newdata = df_te), df_te$Price, form = "traditional")</code>, produces the same result of 0.642401.</p>
<p>Additionally, please note that the performance of the tree is highly dependent on the seed, so setting a different seed can lead to different results.</p>
</div>
</div>
</div>
</section><section id="rmse" class="level2"><h2 class="anchored" data-anchor-id="rmse">RMSE</h2>
<p>Now, we compute the RMSE.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">RMSE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_lm</span>, newdata <span class="op">=</span> <span class="va">df_te</span><span class="op">)</span>, <span class="va">df_te</span><span class="op">$</span><span class="va">Price</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">RMSE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_rt</span>, newdata <span class="op">=</span> <span class="va">df_te</span><span class="op">)</span>, <span class="va">df_te</span><span class="op">$</span><span class="va">Price</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">RMSE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_knn</span>, newdata <span class="op">=</span> <span class="va">df_te</span><span class="op">)</span>, <span class="va">df_te</span><span class="op">$</span><span class="va">Price</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The formula would be:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_lm</span>, newdata <span class="op">=</span> <span class="va">df_te</span><span class="op">)</span><span class="op">-</span><span class="va">df_te</span><span class="op">$</span><span class="va">Price</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, root_mean_squared_error</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(root_mean_squared_error(r.df_te[target], est_lm.predict(r.df_te[predictors])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alternatively in the older version of `sklearn`, you had to run the code below</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print(np.sqrt(mean_squared_error(r.df_te[target], est_lm.predict(r.df_te[predictors]))))</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(root_mean_squared_error(r.df_te[target], est_rt.predict(r.df_te[predictors])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(root_mean_squared_error(r.df_te[target], est_knn.predict(r.df_te[predictors])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><section id="mae" class="level2"><h2 class="anchored" data-anchor-id="mae">MAE</h2>
<p>Now, we compute the MAE.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">MAE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_lm</span>, newdata <span class="op">=</span> <span class="va">df_te</span><span class="op">)</span>, <span class="va">df_te</span><span class="op">$</span><span class="va">Price</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">MAE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_rt</span>, newdata <span class="op">=</span> <span class="va">df_te</span><span class="op">)</span>, <span class="va">df_te</span><span class="op">$</span><span class="va">Price</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">MAE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_knn</span>, newdata <span class="op">=</span> <span class="va">df_te</span><span class="op">)</span>, <span class="va">df_te</span><span class="op">$</span><span class="va">Price</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The formula would be:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_lm</span>, newdata <span class="op">=</span> <span class="va">df_te</span><span class="op">)</span><span class="op">-</span><span class="va">df_te</span><span class="op">$</span><span class="va">Price</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute MAE for each model</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mean_absolute_error(r.df_te[target], est_lm.predict(r.df_te[predictors])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mean_absolute_error(r.df_te[target], est_rt.predict(r.df_te[predictors])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mean_absolute_error(r.df_te[target], est_knn.predict(r.df_te[predictors])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><section id="best-model" class="level2"><h2 class="anchored" data-anchor-id="best-model">Best model</h2>
<p>These three measures agree on the fact that the regression tree is the best model. To inspect further the predictions, we use scatterplots:</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">df_te</span><span class="op">$</span><span class="va">Price</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_lm</span>, newdata <span class="op">=</span> <span class="va">df_te</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"Prediction"</span>, </span>
<span>     ylab<span class="op">=</span><span class="st">"Observed prices"</span>, main<span class="op">=</span><span class="st">"Lin. Reg."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">df_te</span><span class="op">$</span><span class="va">Price</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_rt</span>, newdata <span class="op">=</span> <span class="va">df_te</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"Prediction"</span>, </span>
<span>     ylab<span class="op">=</span><span class="st">"Observed prices"</span>, main<span class="op">=</span><span class="st">"Lin. Reg."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">df_te</span><span class="op">$</span><span class="va">Price</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_knn</span>, newdata <span class="op">=</span> <span class="va">df_te</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"Prediction"</span>, </span>
<span>     ylab<span class="op">=</span><span class="st">"Observed prices"</span>, main<span class="op">=</span><span class="st">"Lin. Reg."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize also in Python</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">221</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(est_lm.predict(r.df_te[predictors]), r.df_te[target], alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Prediction"</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Observed prices"</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Lin. Reg."</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>plt.plot(r.df_te[target], r.df_te[target], color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">222</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>plt.scatter(est_rt.predict(r.df_te[predictors]), r.df_te[target], alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Prediction"</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Observed prices"</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Regression Tree"</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>plt.plot(r.df_te[target], r.df_te[target], color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">223</span>)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>plt.scatter(est_knn.predict(r.df_te[predictors]), r.df_te[target], alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Prediction"</span>)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Observed prices"</span>)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"KNN"</span>)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>plt.plot(r.df_te[target], r.df_te[target], color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The scatterplots are in line with the conclusion that KNN is the best, even though it is not easy to declare from a plot. We can in addition see that the regression tree (RT) has made more error on the larger prices.</p>
</section></section><section id="classification-task" class="level1"><h1>Classification task</h1>
<section id="data-1" class="level2"><h2 class="anchored" data-anchor-id="data-1">Data</h2>
<p>The data set is the visit data (already used in previous exercises). For simplicity, we turn the outcome (<code>visits</code>) into factor. Like before, that are also split into a training and a test set.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">DocVis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"labs/data/DocVis.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">DocVis</span><span class="op">$</span><span class="va">visits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">DocVis</span><span class="op">$</span><span class="va">visits</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">346</span><span class="op">)</span></span>
<span><span class="va">index_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">DocVis</span><span class="op">$</span><span class="va">visits</span>, p<span class="op">=</span> <span class="fl">0.8</span>, list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">df_tr</span> <span class="op">&lt;-</span> <span class="va">DocVis</span><span class="op">[</span><span class="va">index_tr</span>,<span class="op">]</span></span>
<span><span class="va">df_te</span> <span class="op">&lt;-</span> <span class="va">DocVis</span><span class="op">[</span><span class="op">-</span><span class="va">index_tr</span>,<span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="models-1" class="level2"><h2 class="anchored" data-anchor-id="models-1">Models</h2>
<p>We will compare a logistic regression, a classification tree (pruned) and a SVM with radial basis (cost and gamma tuned).</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<p>Note that the <em>code for tuning the SVM</em> is provided below in comments because of the time it takes to run. The final parameters have been selected accordingly. Also, the SVM fit includes the argument <code>probability=TRUE</code> to allow the calculations of predicted probabilities later.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">e1071</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">adabag</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Logistic regression</span></span>
<span><span class="va">Doc_lr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">visits</span><span class="op">~</span><span class="va">.</span>, data<span class="op">=</span><span class="va">df_tr</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="va">Doc_lr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html">step</a></span><span class="op">(</span><span class="va">Doc_lr</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Classification tree </span></span>
<span><span class="va">Doc_ct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adabag/man/autoprune.html">autoprune</a></span><span class="op">(</span><span class="va">visits</span><span class="op">~</span><span class="va">.</span>, data<span class="op">=</span><span class="va">df_tr</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## SVM radial basis</span></span>
<span><span class="co"># grid_radial &lt;- expand.grid(sigma = c(0.0001, 0.001, 0.01, 0.1),</span></span>
<span><span class="co">#                           C = c(0.1, 1, 10, 100, 1000))</span></span>
<span><span class="co"># trctrl &lt;- trainControl(method = "cv", number=10)</span></span>
<span><span class="co"># set.seed(143)</span></span>
<span><span class="co"># Doc_svm &lt;- train(visits ~., data = df_tr, method = "svmRadial",</span></span>
<span><span class="co">#                          trControl=trctrl,</span></span>
<span><span class="co">#                          tuneGrid = grid_radial)</span></span>
<span><span class="va">Doc_svm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/e1071/man/svm.html">svm</a></span><span class="op">(</span><span class="va">visits</span><span class="op">~</span><span class="va">.</span>, data<span class="op">=</span><span class="va">df_tr</span>, gamma<span class="op">=</span><span class="fl">0.001</span>, cost<span class="op">=</span><span class="fl">1000</span>, probability<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># We first put the data in a nice format by one-hot encoding the categorical variables</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> pd.get_dummies(r.df_tr.drop(<span class="st">'visits'</span>, axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> r.df_tr[<span class="st">'visits'</span>]</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> pd.get_dummies(r.df_te.drop(<span class="st">'visits'</span>, axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> r.df_te[<span class="st">'visits'</span>]</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co">## Logistic regression</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>doc_lr <span class="op">=</span> LogisticRegression()</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>doc_lr.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style>
<div id="sk-container-id-1" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>LogisticRegression()</pre>
<b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>LogisticRegression</div></div>
<div>
<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span>
</div></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression()</pre></div> </div></div></div>
</div>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Classification tree</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>doc_ct <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>doc_ct.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-2 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style>
<div id="sk-container-id-2" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>DecisionTreeClassifier(random_state=123)</pre>
<b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>DecisionTreeClassifier</div></div>
<div>
<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.tree.DecisionTreeClassifier.html">?<span>Documentation for DecisionTreeClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span>
</div></label><div class="sk-toggleable__content fitted"><pre>DecisionTreeClassifier(random_state=123)</pre></div> </div></div></div>
</div>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">## SVM radial basis</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>doc_svm <span class="op">=</span> SVC(kernel<span class="op">=</span><span class="st">'rbf'</span>, gamma<span class="op">=</span><span class="fl">0.001</span>, C<span class="op">=</span><span class="dv">1000</span>, probability<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>doc_svm.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-3 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-3 {
  color: var(--sklearn-color-text);
}

#sk-container-id-3 pre {
  padding: 0;
}

#sk-container-id-3 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-3 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-3 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-3 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-3 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-3 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-3 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-3 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-3 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-3 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-3 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-3 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-3 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-3 div.sk-label label.sk-toggleable__label,
#sk-container-id-3 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-3 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-3 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-3 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-3 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-3 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-3 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-3 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-3 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-3 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style>
<div id="sk-container-id-3" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>SVC(C=1000, gamma=0.001, probability=True, random_state=123)</pre>
<b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked=""><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>SVC</div></div>
<div>
<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.svm.SVC.html">?<span>Documentation for SVC</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span>
</div></label><div class="sk-toggleable__content fitted"><pre>SVC(C=1000, gamma=0.001, probability=True, random_state=123)</pre></div> </div></div></div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="predictions" class="level2"><h2 class="anchored" data-anchor-id="predictions">Predictions</h2>
<p>We now compute the predicted probabilities and the predictions of all the models.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<p>Note that, for SVM, we need to extract the <em>attribute</em> “probabilities” from the predicted object. This can be done with the <code>attr</code> function.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Logistic regression</span></span>
<span><span class="va">Doc_lr_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">Doc_lr</span>, newdata<span class="op">=</span><span class="va">df_te</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">Doc_lr_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">Doc_lr_prob</span><span class="op">&gt;</span><span class="fl">0.5</span>,<span class="st">"Yes"</span>,<span class="st">"No"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Classification tree </span></span>
<span><span class="va">Doc_ct_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">Doc_ct</span>, newdata<span class="op">=</span><span class="va">df_te</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span></span>
<span><span class="va">Doc_ct_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">Doc_ct</span>, newdata<span class="op">=</span><span class="va">df_te</span>, type<span class="op">=</span><span class="st">"class"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## SVM radial basis</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">Doc_svm_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">Doc_svm</span>, newdata<span class="op">=</span><span class="va">df_te</span>, probability<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="st">"probabilities"</span><span class="op">)</span></span>
<span><span class="va">Doc_svm_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">Doc_svm</span>, newdata<span class="op">=</span><span class="va">df_te</span>, type<span class="op">=</span><span class="st">"class"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Logistic regression</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">## the second column represents the `no` values, to make sure of that, you can run `doc_lr.classes_`</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>doc_lr_prob <span class="op">=</span> doc_lr.predict_proba(X_test)[:,<span class="dv">1</span>]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>doc_lr_pred <span class="op">=</span> np.where(doc_lr_prob<span class="op">&gt;</span><span class="fl">0.5</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Classification tree</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>doc_ct_prob <span class="op">=</span> doc_ct.predict_proba(X_test)[:,<span class="dv">1</span>]</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>doc_ct_pred <span class="op">=</span> doc_ct.predict(X_test)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">## SVM radial basis</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>doc_svm_prob <span class="op">=</span> doc_svm.predict_proba(X_test)[:,<span class="dv">1</span>]</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>doc_svm_pred <span class="op">=</span> doc_svm.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><section id="confusion-matrices-prediction-based-measures" class="level2"><h2 class="anchored" data-anchor-id="confusion-matrices-prediction-based-measures">Confusion matrices &amp; prediction-based measures</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<p>The <code>confusionMatrix</code> function provides all the accuracy measures that we want.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Doc_lr_pred</span><span class="op">)</span>, reference <span class="op">=</span> <span class="va">df_te</span><span class="op">$</span><span class="va">visits</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Doc_ct_pred</span><span class="op">)</span>, reference <span class="op">=</span> <span class="va">df_te</span><span class="op">$</span><span class="va">visits</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Doc_svm_pred</span><span class="op">)</span>, reference <span class="op">=</span> <span class="va">df_te</span><span class="op">$</span><span class="va">visits</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, accuracy_score, balanced_accuracy_score, cohen_kappa_score</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Logistic regression</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confusion_matrix(y_test, doc_lr_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy: </span><span class="sc">{</span>accuracy_score(y_test, doc_lr_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Kappa: </span><span class="sc">{</span>cohen_kappa_score(y_test, doc_lr_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Balanced accuracy: </span><span class="sc">{</span>balanced_accuracy_score(y_test, doc_lr_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Classification tree</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confusion_matrix(y_test, doc_ct_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy: </span><span class="sc">{</span>accuracy_score(y_test, doc_ct_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Kappa: </span><span class="sc">{</span>cohen_kappa_score(y_test, doc_ct_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Balanced accuracy: </span><span class="sc">{</span>balanced_accuracy_score(y_test, doc_ct_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">## SVM radial basis</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confusion_matrix(y_test, doc_svm_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy: </span><span class="sc">{</span>accuracy_score(y_test, doc_svm_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Kappa: </span><span class="sc">{</span>cohen_kappa_score(y_test, doc_svm_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Balanced accuracy: </span><span class="sc">{</span>balanced_accuracy_score(y_test, doc_svm_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Different results for the tree and CSV due to randomness, but even with that, SVM remains the best model in terms of accuracy.</p>
</div>
</div>
</div>
<p>The conclusion may be different from one measure to another</p>
<ul>
<li>Accuracy: the SVM reaches the highest accuracy</li>
<li>Kappa: the CT is the highest.</li>
<li>Balanced accuracy: the CT is the highest.</li>
<li>etc.</li>
</ul>
<p>Looking at the confusion matrix, we see that the data is highly unbalanced (many more “No” than “Yes”). Therefore, measures like balanced accuracy and kappa are interesting because they take this characteristics into account. This shows that the CT is probably better than the SVM because it reaches a better balance between predicting “Yes” and “No”.</p>
<p>By looking at the sensitivity and specificity (<u>!! here the positive class is “No”</u>), we see that the best model to recover the “No” is the logistic regression (largest sensitivity) and the best model to recover the “Yes” is the classification tree (largest specificity).</p>
</section><section id="probability-based-measures" class="level2"><h2 class="anchored" data-anchor-id="probability-based-measures">Probability-based measures</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<p>To compute the AUC (area under the ROC curve) we can use the <code><a href="https://rdrr.io/pkg/caret/man/postResample.html">caret::twoClassSummary</a></code> function. The use of this function can be tricky. Its argument should be a data frame with columns (names are fixed):</p>
<ul>
<li>“obs”: the observed classes</li>
<li>“pred”: the predicted classes</li>
<li>two columns with names being the levels of the classes, here “Yes” and “No”, containing the predicted probabilities.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_pred_lr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>obs<span class="op">=</span><span class="va">df_te</span><span class="op">$</span><span class="va">visits</span>,</span>
<span>                         Yes<span class="op">=</span><span class="va">Doc_lr_prob</span>,</span>
<span>                         No<span class="op">=</span><span class="fl">1</span><span class="op">-</span><span class="va">Doc_lr_prob</span>,</span>
<span>                         pred<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Doc_lr_pred</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_pred_lr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_pred_ct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>obs<span class="op">=</span><span class="va">df_te</span><span class="op">$</span><span class="va">visits</span>,</span>
<span>                         <span class="va">Doc_ct_prob</span>,</span>
<span>                         pred<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Doc_ct_pred</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_pred_ct</span><span class="op">)</span></span>
<span><span class="va">df_pred_svm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>obs<span class="op">=</span><span class="va">df_te</span><span class="op">$</span><span class="va">visits</span>,</span>
<span>                          <span class="va">Doc_svm_prob</span>,</span>
<span>                          pred<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Doc_svm_pred</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_pred_svm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we pass these objects to the function, and levels of the classes to be predicted (for the function to be able to recover them in the data frame). The function compute the AUC by default (under the name ROC_.. not very wise) as well as sensitivity and specificity (that we already have).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">twoClassSummary</a></span><span class="op">(</span><span class="va">df_pred_lr</span>, lev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df_pred_lr</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">twoClassSummary</a></span><span class="op">(</span><span class="va">df_pred_ct</span>, lev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df_pred_lr</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">twoClassSummary</a></span><span class="op">(</span><span class="va">df_pred_svm</span>, lev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df_pred_lr</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This brings us another view: the logistic regression has the highest AUC. This shows that varying the prediction threshold provides a good potential of improving the specificity and the sensitivity (in fine, the balanced accuracy).</p>
<p>Now we compute the entropy using the <code>mnLogLoss</code> function (entropy is also called <em>log-loss</em>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">mnLogLoss</a></span><span class="op">(</span><span class="va">df_pred_lr</span>, lev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df_pred_lr</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">mnLogLoss</a></span><span class="op">(</span><span class="va">df_pred_ct</span>, lev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df_pred_lr</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">mnLogLoss</a></span><span class="op">(</span><span class="va">df_pred_svm</span>, lev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df_pred_lr</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here again, the entropy selects the logistic regression as the best model, though close to classification tree and SVM.</p>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score, roc_curve</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Logistic regression</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>roc_auc_score(y_test, doc_lr_prob)<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Classification tree</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>roc_auc_score(y_test, doc_ct_prob)<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">## SVM radial basis</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>roc_auc_score(y_test, doc_svm_prob)<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we compute the entropy using the `log_loss` function (entropy is also called *log-loss*).</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> log_loss</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Logistic regression</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Log-loss: </span><span class="sc">{</span>log_loss(y_test, doc_lr_prob)<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Classification tree</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Log-loss: </span><span class="sc">{</span>log_loss(y_test, doc_ct_prob)<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">## SVM radial basis</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Log-loss: </span><span class="sc">{</span>log_loss(y_test, doc_svm_prob)<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><section id="roc-curve-prob-threshold-tuning" class="level2"><h2 class="anchored" data-anchor-id="roc-curve-prob-threshold-tuning">ROC curve &amp; prob threshold tuning</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<p>To go deeper in the analysis, we now produce the ROC curve of each model using the <code>roc</code> function of the <code>proc</code> package.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://xrobin.github.io/pROC/">pROC</a></span><span class="op">)</span></span>
<span><span class="va">ROC_lr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">obs</span> <span class="op">~</span> <span class="va">Yes</span>, data<span class="op">=</span><span class="va">df_pred_lr</span><span class="op">)</span></span>
<span><span class="va">ROC_ct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">obs</span> <span class="op">~</span> <span class="va">Yes</span>, data<span class="op">=</span><span class="va">df_pred_ct</span><span class="op">)</span></span>
<span><span class="va">ROC_svm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">obs</span> <span class="op">~</span> <span class="va">Yes</span>, data<span class="op">=</span><span class="va">df_pred_svm</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ROC_lr</span>, print.thres<span class="op">=</span><span class="st">"best"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ROC_ct</span>, print.thres<span class="op">=</span><span class="st">"best"</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ROC_svm</span>, print.thres<span class="op">=</span><span class="st">"best"</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The plotting function provides an “optimal” threshold that reaches the best trade-off between sensitivity and specificity (according to some criterion). We see that there is room to improve this trade-off.</p>
<p>Now, to tune this threshold, we need to do it <em>on the training set</em> to avoid overfitting. To do this, we just repeat the previous calculations (predictions) on the training set. To simplify, we only do this on the logistic regression (note that you can try on the other models; you may find that logistic regression is the best one).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Doc_lr_prob_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">Doc_lr</span>, newdata<span class="op">=</span><span class="va">df_tr</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">df_pred_lr_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>obs<span class="op">=</span><span class="va">df_tr</span><span class="op">$</span><span class="va">visits</span>,</span>
<span>                            Yes<span class="op">=</span><span class="va">Doc_lr_prob_tr</span><span class="op">)</span></span>
<span><span class="va">ROC_lr_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">obs</span> <span class="op">~</span> <span class="va">Yes</span>, data<span class="op">=</span><span class="va">df_pred_lr_tr</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ROC_lr_tr</span>, print.thres<span class="op">=</span><span class="st">"best"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The best threshold is 0.193. Now let us compute the confusion table with this threshold.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Doc_lr_pred_opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">Doc_lr_prob</span><span class="op">&gt;</span><span class="fl">0.193</span>,<span class="st">"Yes"</span>,<span class="st">"No"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Doc_lr_pred_opt</span><span class="op">)</span>, reference <span class="op">=</span> <span class="va">df_te</span><span class="op">$</span><span class="va">visits</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now have a model with an accuracy of circa <span class="math inline">\(70\%\)</span> but with a balanced accuracy of <span class="math inline">\(67\%\)</span>. Far from perfect, this is still an interesting improvement compare to the CT <span class="math inline">\(62\%\)</span>. The specificity and sensitivity are now respectively <span class="math inline">\(62\%\)</span> and <span class="math inline">\(72\%\)</span>. The specificity in particular made a huge improvement (from around <span class="math inline">\(29\%\)</span> at best - by CT - to <span class="math inline">\(62\%\)</span> - by log. reg).</p>
<p>If the aim is to predict both “Yes” and “No”, this last model (log. reg. with tuned threshold) is the best one to use.</p>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Logistic regression</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co">## We need to turn back our results into binary values to be plotted</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>doc_lr_prob_dict <span class="op">=</span> {<span class="st">'Yes'</span>: <span class="dv">1</span>, <span class="st">'No'</span>: <span class="dv">0</span>}</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>y_test_binary <span class="op">=</span> np.array([doc_lr_prob_dict[x] <span class="cf">for</span> x <span class="kw">in</span> y_test])</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>fpr_lr, tpr_lr, thresholds_lr <span class="op">=</span> roc_curve(y_test_binary, doc_lr_prob)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr_lr, tpr_lr, label<span class="op">=</span><span class="st">"Logistic Regression"</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Classification tree</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>doc_ct_prob_dict <span class="op">=</span> {<span class="st">'Yes'</span>: <span class="dv">1</span>, <span class="st">'No'</span>: <span class="dv">0</span>}</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>y_test_binary <span class="op">=</span> np.array([doc_ct_prob_dict[x] <span class="cf">for</span> x <span class="kw">in</span> y_test])</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>fpr_ct, tpr_ct, thresholds_ct <span class="op">=</span> roc_curve(y_test_binary, doc_ct_prob)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr_ct, tpr_ct, label<span class="op">=</span><span class="st">"Classification Tree"</span>)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="co">## SVM radial basis</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>doc_svm_prob_dict <span class="op">=</span> {<span class="st">'Yes'</span>: <span class="dv">1</span>, <span class="st">'No'</span>: <span class="dv">0</span>}</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>y_test_binary <span class="op">=</span> np.array([doc_svm_prob_dict[x] <span class="cf">for</span> x <span class="kw">in</span> y_test])</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>fpr_svm, tpr_svm, thresholds_svm <span class="op">=</span> roc_curve(y_test_binary, doc_svm_prob)</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Clear the last plot (if any)</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.clf()</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr_svm, tpr_svm, label<span class="op">=</span><span class="st">"SVM Radial Basis"</span>)</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the ROC curve</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">"Random Classifier"</span>)</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC Curve"</span>)</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then plot the results in the similar way to R:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>doc_lr_prob_tr <span class="op">=</span> doc_lr.predict_proba(X_train)[:,<span class="dv">1</span>]</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>doc_lr_prob_tr_dict <span class="op">=</span> {<span class="st">'Yes'</span>: <span class="dv">1</span>, <span class="st">'No'</span>: <span class="dv">0</span>}</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>y_train_binary <span class="op">=</span> np.array([doc_lr_prob_tr_dict[x] <span class="cf">for</span> x <span class="kw">in</span> y_train])</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>fpr_lr_tr, tpr_lr_tr, thresholds_lr_tr <span class="op">=</span> roc_curve(y_train_binary, doc_lr_prob_tr)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>optimal_idx <span class="op">=</span> np.argmax(tpr_lr_tr <span class="op">-</span> fpr_lr_tr)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>optimal_threshold <span class="op">=</span> thresholds_lr_tr[optimal_idx]</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Optimal threshold: </span><span class="sc">{</span>optimal_threshold<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we print the confusion matrix again:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>doc_lr_pred_opt <span class="op">=</span> np.where(doc_lr_prob <span class="op">&gt;</span> optimal_threshold, <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confusion_matrix(y_test, doc_lr_pred_opt))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The logistic regression produced with R was better.</p>
</div>
</div>
</div>
</section></section><section id="your-turn" class="level1"><h1>Your turn</h1>
<section id="classification" class="level2"><h2 class="anchored" data-anchor-id="classification">Classification</h2>
<p>Repeat the analysis on the German credit data. Put several models in competition. Tune them and try to optimize their threshold. Select the best one and analyze its performance.</p>
</section><section id="regression" class="level2"><h2 class="anchored" data-anchor-id="regression">Regression</h2>
<p>Repeat the analysis on the nursing cost data. Put several models in competition. Tune them and select the best one. Analyze its performance using a scatterplot.</p>


<!-- -->

</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../../labs/03_Models/034_SupportVectorMachine/Ex_ML_SVM.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Support Vector Machines</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../labs/05_DataSplitting/Ex_ML_Data_Splitting.html" class="pagination-link">
        <span class="nav-page-text">Data Splitting</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb59" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>How can I render the following?---</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>title: "Model scoring"</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r global_options, include = FALSE}</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">fig.align=</span><span class="st">"center"</span>, <span class="at">results =</span> <span class="st">'hide'</span>, <span class="at">fig.show =</span> <span class="st">'hide'</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="fu"># Regression task</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>The data set is the one used in the series on linear regressions.</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>real_estate_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"labs/data/real_estate_data.csv"</span>))</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>Then we split the data in a training and a test set (0.8/0.2). For this, we use the <span class="in">`createDataPartition`</span> function of the <span class="in">`caret`</span> package.</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">234</span>)</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>index_tr <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(<span class="at">y =</span> real_estate_data<span class="sc">$</span>Price, <span class="at">p=</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>df_tr <span class="ot">&lt;-</span> real_estate_data[index_tr,]</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>df_te <span class="ot">&lt;-</span> real_estate_data[<span class="sc">-</span>index_tr,]</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a><span class="fu">## Models</span></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>We will compare a linear regression, a regression tree and a 3-NN (KNN).</span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a><span class="fu">### R</span></span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>est_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price<span class="sc">~</span>TransDate<span class="sc">+</span>HouseAge<span class="sc">+</span>Dist<span class="sc">+</span></span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>               NumStores<span class="sc">+</span>Lat<span class="sc">+</span>Long, <span class="at">data=</span>df_tr)</span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a>est_rt <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Price<span class="sc">~</span>TransDate<span class="sc">+</span>HouseAge<span class="sc">+</span>Dist<span class="sc">+</span></span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a>                      NumStores<span class="sc">+</span>Lat<span class="sc">+</span>Long, <span class="at">data=</span>df_tr)</span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a>est_knn <span class="ot">&lt;-</span> <span class="fu">knnreg</span>(Price<span class="sc">~</span>TransDate<span class="sc">+</span>HouseAge<span class="sc">+</span>Dist<span class="sc">+</span></span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a>                      NumStores<span class="sc">+</span>Lat<span class="sc">+</span>Long, <span class="at">data=</span>df_tr, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb59-51"><a href="#cb59-51" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-52"><a href="#cb59-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-53"><a href="#cb59-53" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python</span></span>
<span id="cb59-56"><a href="#cb59-56" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-57"><a href="#cb59-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the course python environment as usual with a r code chunks.</span></span>
<span id="cb59-58"><a href="#cb59-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb59-59"><a href="#cb59-59" aria-hidden="true" tabindex="-1"></a><span class="fu">use_condaenv</span>(<span class="st">"MLBA"</span>)</span>
<span id="cb59-60"><a href="#cb59-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-61"><a href="#cb59-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-64"><a href="#cb59-64" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb59-65"><a href="#cb59-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the models: linear regression, regression tree, and KNN</span></span>
<span id="cb59-66"><a href="#cb59-66" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb59-67"><a href="#cb59-67" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb59-68"><a href="#cb59-68" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="cb59-69"><a href="#cb59-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-70"><a href="#cb59-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Define predictors and target variable</span></span>
<span id="cb59-71"><a href="#cb59-71" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">'TransDate'</span>, <span class="st">'HouseAge'</span>, <span class="st">'Dist'</span>, <span class="st">'NumStores'</span>, <span class="st">'Lat'</span>, <span class="st">'Long'</span>]</span>
<span id="cb59-72"><a href="#cb59-72" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> <span class="st">'Price'</span></span>
<span id="cb59-73"><a href="#cb59-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-74"><a href="#cb59-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models</span></span>
<span id="cb59-75"><a href="#cb59-75" aria-hidden="true" tabindex="-1"></a>est_lm <span class="op">=</span> LinearRegression().fit(r.df_tr[predictors], r.df_tr[target])</span>
<span id="cb59-76"><a href="#cb59-76" aria-hidden="true" tabindex="-1"></a>est_rt <span class="op">=</span> DecisionTreeRegressor(random_state<span class="op">=</span><span class="dv">234</span>).fit(r.df_tr[predictors], r.df_tr[target])</span>
<span id="cb59-77"><a href="#cb59-77" aria-hidden="true" tabindex="-1"></a>est_knn <span class="op">=</span> KNeighborsRegressor(n_neighbors<span class="op">=</span><span class="dv">3</span>).fit(r.df_tr[predictors], r.df_tr[target])</span>
<span id="cb59-78"><a href="#cb59-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-79"><a href="#cb59-79" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-80"><a href="#cb59-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-81"><a href="#cb59-81" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb59-82"><a href="#cb59-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-83"><a href="#cb59-83" aria-hidden="true" tabindex="-1"></a><span class="fu">## R-squared</span></span>
<span id="cb59-84"><a href="#cb59-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-85"><a href="#cb59-85" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb59-86"><a href="#cb59-86" aria-hidden="true" tabindex="-1"></a><span class="fu">### R</span></span>
<span id="cb59-87"><a href="#cb59-87" aria-hidden="true" tabindex="-1"></a>We now compute the R2 for each model using the <span class="in">`R2`</span> function (in <span class="in">`caret`</span>).</span>
<span id="cb59-88"><a href="#cb59-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-91"><a href="#cb59-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-92"><a href="#cb59-92" aria-hidden="true" tabindex="-1"></a><span class="fu">R2</span>(<span class="fu">predict</span>(est_lm, <span class="at">newdata =</span> df_te), df_te<span class="sc">$</span>Price)</span>
<span id="cb59-93"><a href="#cb59-93" aria-hidden="true" tabindex="-1"></a><span class="fu">R2</span>(<span class="fu">predict</span>(est_rt, <span class="at">newdata =</span> df_te), df_te<span class="sc">$</span>Price)</span>
<span id="cb59-94"><a href="#cb59-94" aria-hidden="true" tabindex="-1"></a><span class="fu">R2</span>(<span class="fu">predict</span>(est_knn, <span class="at">newdata =</span> df_te), df_te<span class="sc">$</span>Price)</span>
<span id="cb59-95"><a href="#cb59-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-96"><a href="#cb59-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-97"><a href="#cb59-97" aria-hidden="true" tabindex="-1"></a>Just for the exercise, we can compute it by hand (square of the correlation)</span>
<span id="cb59-98"><a href="#cb59-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-101"><a href="#cb59-101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-102"><a href="#cb59-102" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(<span class="fu">predict</span>(est_lm, <span class="at">newdata =</span> df_te), df_te<span class="sc">$</span>Price)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb59-103"><a href="#cb59-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-104"><a href="#cb59-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-105"><a href="#cb59-105" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python</span></span>
<span id="cb59-106"><a href="#cb59-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-109"><a href="#cb59-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb59-110"><a href="#cb59-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Same thing as the R code</span></span>
<span id="cb59-111"><a href="#cb59-111" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score</span>
<span id="cb59-112"><a href="#cb59-112" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb59-113"><a href="#cb59-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-114"><a href="#cb59-114" aria-hidden="true" tabindex="-1"></a><span class="co"># Only to demonostrate which argument goes where (different from `caret::R2`)</span></span>
<span id="cb59-115"><a href="#cb59-115" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r2_score(y_true <span class="op">=</span> r.df_te[target], y_pred <span class="op">=</span> est_lm.predict(r.df_te[predictors])))</span>
<span id="cb59-116"><a href="#cb59-116" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r2_score(r.df_te[target], est_rt.predict(r.df_te[predictors])))</span>
<span id="cb59-117"><a href="#cb59-117" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r2_score(r.df_te[target], est_knn.predict(r.df_te[predictors])))</span>
<span id="cb59-118"><a href="#cb59-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-119"><a href="#cb59-119" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing it by hand gives us the same result as R</span></span>
<span id="cb59-120"><a href="#cb59-120" aria-hidden="true" tabindex="-1"></a>np.corrcoef(est_lm.predict(r.df_te[predictors]), r.df_te[target])[<span class="dv">0</span>][<span class="dv">1</span>]<span class="op">**</span><span class="dv">2</span></span>
<span id="cb59-121"><a href="#cb59-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-122"><a href="#cb59-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-123"><a href="#cb59-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-124"><a href="#cb59-124" aria-hidden="true" tabindex="-1"></a>To understand why the results are different in <span class="in">`caret::R2()`</span> vs. <span class="in">`sklearn.metrics.r2_score()`</span>, </span>
<span id="cb59-125"><a href="#cb59-125" aria-hidden="true" tabindex="-1"></a>see <span class="co">[</span><span class="ot">this post on stackoverflow</span><span class="co">](https://stats.stackexchange.com/questions/586821/what-is-the-interpretation-of-the-traditional-r2)</span>. If you want to get the same results in both, you can set the argument <span class="in">`form = 'corr'`</span> to <span class="in">`form = "traditional"`</span> in <span class="in">`caret::R2()`</span> so that for instance <span class="in">`R2(predict(est_lm, newdata = df_te), df_te$Price, form = "traditional")`</span>, produces the same result of <span class="in">`r R2(predict(est_lm, newdata = df_te), df_te$Price, form = "traditional")`</span>.</span>
<span id="cb59-126"><a href="#cb59-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-127"><a href="#cb59-127" aria-hidden="true" tabindex="-1"></a>Additionally, please note that the performance of the tree is highly dependent on the seed, so setting a different seed can lead to different results.</span>
<span id="cb59-128"><a href="#cb59-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-129"><a href="#cb59-129" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb59-130"><a href="#cb59-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-131"><a href="#cb59-131" aria-hidden="true" tabindex="-1"></a><span class="fu">## RMSE</span></span>
<span id="cb59-132"><a href="#cb59-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-133"><a href="#cb59-133" aria-hidden="true" tabindex="-1"></a>Now, we compute the RMSE.</span>
<span id="cb59-134"><a href="#cb59-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-135"><a href="#cb59-135" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb59-136"><a href="#cb59-136" aria-hidden="true" tabindex="-1"></a><span class="fu">### R</span></span>
<span id="cb59-137"><a href="#cb59-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-140"><a href="#cb59-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-141"><a href="#cb59-141" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSE</span>(<span class="fu">predict</span>(est_lm, <span class="at">newdata =</span> df_te), df_te<span class="sc">$</span>Price)</span>
<span id="cb59-142"><a href="#cb59-142" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSE</span>(<span class="fu">predict</span>(est_rt, <span class="at">newdata =</span> df_te), df_te<span class="sc">$</span>Price)</span>
<span id="cb59-143"><a href="#cb59-143" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSE</span>(<span class="fu">predict</span>(est_knn, <span class="at">newdata =</span> df_te), df_te<span class="sc">$</span>Price)</span>
<span id="cb59-144"><a href="#cb59-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-145"><a href="#cb59-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-146"><a href="#cb59-146" aria-hidden="true" tabindex="-1"></a>The formula would be:</span>
<span id="cb59-147"><a href="#cb59-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-150"><a href="#cb59-150" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-151"><a href="#cb59-151" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>((<span class="fu">predict</span>(est_lm, <span class="at">newdata =</span> df_te)<span class="sc">-</span>df_te<span class="sc">$</span>Price)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb59-152"><a href="#cb59-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-153"><a href="#cb59-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-154"><a href="#cb59-154" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python</span></span>
<span id="cb59-155"><a href="#cb59-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-158"><a href="#cb59-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb59-159"><a href="#cb59-159" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, root_mean_squared_error</span>
<span id="cb59-160"><a href="#cb59-160" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb59-161"><a href="#cb59-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-162"><a href="#cb59-162" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(root_mean_squared_error(r.df_te[target], est_lm.predict(r.df_te[predictors])))</span>
<span id="cb59-163"><a href="#cb59-163" aria-hidden="true" tabindex="-1"></a><span class="co"># alternatively in the older version of `sklearn`, you had to run the code below</span></span>
<span id="cb59-164"><a href="#cb59-164" aria-hidden="true" tabindex="-1"></a><span class="co"># print(np.sqrt(mean_squared_error(r.df_te[target], est_lm.predict(r.df_te[predictors]))))</span></span>
<span id="cb59-165"><a href="#cb59-165" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(root_mean_squared_error(r.df_te[target], est_rt.predict(r.df_te[predictors])))</span>
<span id="cb59-166"><a href="#cb59-166" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(root_mean_squared_error(r.df_te[target], est_knn.predict(r.df_te[predictors])))</span>
<span id="cb59-167"><a href="#cb59-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-168"><a href="#cb59-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-169"><a href="#cb59-169" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb59-170"><a href="#cb59-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-171"><a href="#cb59-171" aria-hidden="true" tabindex="-1"></a><span class="fu">## MAE</span></span>
<span id="cb59-172"><a href="#cb59-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-173"><a href="#cb59-173" aria-hidden="true" tabindex="-1"></a>Now, we compute the MAE.</span>
<span id="cb59-174"><a href="#cb59-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-175"><a href="#cb59-175" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb59-176"><a href="#cb59-176" aria-hidden="true" tabindex="-1"></a><span class="fu">### R</span></span>
<span id="cb59-177"><a href="#cb59-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-180"><a href="#cb59-180" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-181"><a href="#cb59-181" aria-hidden="true" tabindex="-1"></a><span class="fu">MAE</span>(<span class="fu">predict</span>(est_lm, <span class="at">newdata =</span> df_te), df_te<span class="sc">$</span>Price)</span>
<span id="cb59-182"><a href="#cb59-182" aria-hidden="true" tabindex="-1"></a><span class="fu">MAE</span>(<span class="fu">predict</span>(est_rt, <span class="at">newdata =</span> df_te), df_te<span class="sc">$</span>Price)</span>
<span id="cb59-183"><a href="#cb59-183" aria-hidden="true" tabindex="-1"></a><span class="fu">MAE</span>(<span class="fu">predict</span>(est_knn, <span class="at">newdata =</span> df_te), df_te<span class="sc">$</span>Price)</span>
<span id="cb59-184"><a href="#cb59-184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-185"><a href="#cb59-185" aria-hidden="true" tabindex="-1"></a>The formula would be:</span>
<span id="cb59-186"><a href="#cb59-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-189"><a href="#cb59-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-190"><a href="#cb59-190" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">abs</span>(<span class="fu">predict</span>(est_lm, <span class="at">newdata =</span> df_te)<span class="sc">-</span>df_te<span class="sc">$</span>Price))</span>
<span id="cb59-191"><a href="#cb59-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-192"><a href="#cb59-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-193"><a href="#cb59-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-194"><a href="#cb59-194" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python</span></span>
<span id="cb59-195"><a href="#cb59-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-198"><a href="#cb59-198" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb59-199"><a href="#cb59-199" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute MAE for each model</span></span>
<span id="cb59-200"><a href="#cb59-200" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error</span>
<span id="cb59-201"><a href="#cb59-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-202"><a href="#cb59-202" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mean_absolute_error(r.df_te[target], est_lm.predict(r.df_te[predictors])))</span>
<span id="cb59-203"><a href="#cb59-203" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mean_absolute_error(r.df_te[target], est_rt.predict(r.df_te[predictors])))</span>
<span id="cb59-204"><a href="#cb59-204" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mean_absolute_error(r.df_te[target], est_knn.predict(r.df_te[predictors])))</span>
<span id="cb59-205"><a href="#cb59-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-206"><a href="#cb59-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-207"><a href="#cb59-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-208"><a href="#cb59-208" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb59-209"><a href="#cb59-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-210"><a href="#cb59-210" aria-hidden="true" tabindex="-1"></a><span class="fu">## Best model</span></span>
<span id="cb59-211"><a href="#cb59-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-212"><a href="#cb59-212" aria-hidden="true" tabindex="-1"></a>These three measures agree on the fact that the regression tree is the best model. To inspect further the predictions, we use scatterplots:</span>
<span id="cb59-213"><a href="#cb59-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-214"><a href="#cb59-214" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb59-215"><a href="#cb59-215" aria-hidden="true" tabindex="-1"></a><span class="fu">### R</span></span>
<span id="cb59-216"><a href="#cb59-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-219"><a href="#cb59-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-220"><a href="#cb59-220" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb59-221"><a href="#cb59-221" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df_te<span class="sc">$</span>Price <span class="sc">~</span> <span class="fu">predict</span>(est_lm, <span class="at">newdata =</span> df_te), <span class="at">xlab=</span><span class="st">"Prediction"</span>, </span>
<span id="cb59-222"><a href="#cb59-222" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Observed prices"</span>, <span class="at">main=</span><span class="st">"Lin. Reg."</span>)</span>
<span id="cb59-223"><a href="#cb59-223" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb59-224"><a href="#cb59-224" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df_te<span class="sc">$</span>Price <span class="sc">~</span> <span class="fu">predict</span>(est_rt, <span class="at">newdata =</span> df_te), <span class="at">xlab=</span><span class="st">"Prediction"</span>, </span>
<span id="cb59-225"><a href="#cb59-225" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Observed prices"</span>, <span class="at">main=</span><span class="st">"Lin. Reg."</span>)</span>
<span id="cb59-226"><a href="#cb59-226" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb59-227"><a href="#cb59-227" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df_te<span class="sc">$</span>Price <span class="sc">~</span> <span class="fu">predict</span>(est_knn, <span class="at">newdata =</span> df_te), <span class="at">xlab=</span><span class="st">"Prediction"</span>, </span>
<span id="cb59-228"><a href="#cb59-228" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Observed prices"</span>, <span class="at">main=</span><span class="st">"Lin. Reg."</span>)</span>
<span id="cb59-229"><a href="#cb59-229" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb59-230"><a href="#cb59-230" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb59-231"><a href="#cb59-231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-232"><a href="#cb59-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-233"><a href="#cb59-233" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python</span></span>
<span id="cb59-236"><a href="#cb59-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb59-237"><a href="#cb59-237" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize also in Python</span></span>
<span id="cb59-238"><a href="#cb59-238" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb59-239"><a href="#cb59-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-240"><a href="#cb59-240" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb59-241"><a href="#cb59-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-242"><a href="#cb59-242" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">221</span>)</span>
<span id="cb59-243"><a href="#cb59-243" aria-hidden="true" tabindex="-1"></a>plt.scatter(est_lm.predict(r.df_te[predictors]), r.df_te[target], alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb59-244"><a href="#cb59-244" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Prediction"</span>)</span>
<span id="cb59-245"><a href="#cb59-245" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Observed prices"</span>)</span>
<span id="cb59-246"><a href="#cb59-246" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Lin. Reg."</span>)</span>
<span id="cb59-247"><a href="#cb59-247" aria-hidden="true" tabindex="-1"></a>plt.plot(r.df_te[target], r.df_te[target], color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb59-248"><a href="#cb59-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-249"><a href="#cb59-249" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">222</span>)</span>
<span id="cb59-250"><a href="#cb59-250" aria-hidden="true" tabindex="-1"></a>plt.scatter(est_rt.predict(r.df_te[predictors]), r.df_te[target], alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb59-251"><a href="#cb59-251" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Prediction"</span>)</span>
<span id="cb59-252"><a href="#cb59-252" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Observed prices"</span>)</span>
<span id="cb59-253"><a href="#cb59-253" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Regression Tree"</span>)</span>
<span id="cb59-254"><a href="#cb59-254" aria-hidden="true" tabindex="-1"></a>plt.plot(r.df_te[target], r.df_te[target], color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb59-255"><a href="#cb59-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-256"><a href="#cb59-256" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">223</span>)</span>
<span id="cb59-257"><a href="#cb59-257" aria-hidden="true" tabindex="-1"></a>plt.scatter(est_knn.predict(r.df_te[predictors]), r.df_te[target], alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb59-258"><a href="#cb59-258" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Prediction"</span>)</span>
<span id="cb59-259"><a href="#cb59-259" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Observed prices"</span>)</span>
<span id="cb59-260"><a href="#cb59-260" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"KNN"</span>)</span>
<span id="cb59-261"><a href="#cb59-261" aria-hidden="true" tabindex="-1"></a>plt.plot(r.df_te[target], r.df_te[target], color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb59-262"><a href="#cb59-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-263"><a href="#cb59-263" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb59-264"><a href="#cb59-264" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb59-265"><a href="#cb59-265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-266"><a href="#cb59-266" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb59-267"><a href="#cb59-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-268"><a href="#cb59-268" aria-hidden="true" tabindex="-1"></a>The scatterplots are in line with the conclusion that KNN is the best, even though it is not easy to declare from a plot. We can in addition see that the regression tree (RT) has made more error on the larger prices.</span>
<span id="cb59-269"><a href="#cb59-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-270"><a href="#cb59-270" aria-hidden="true" tabindex="-1"></a><span class="fu"># Classification task</span></span>
<span id="cb59-271"><a href="#cb59-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-272"><a href="#cb59-272" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb59-273"><a href="#cb59-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-274"><a href="#cb59-274" aria-hidden="true" tabindex="-1"></a>The data set is the visit data (already used in previous exercises). For simplicity, we turn the outcome (<span class="in">`visits`</span>) into factor. Like before, that are also split into a training and a test set.</span>
<span id="cb59-275"><a href="#cb59-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-278"><a href="#cb59-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-279"><a href="#cb59-279" aria-hidden="true" tabindex="-1"></a>DocVis <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"labs/data/DocVis.csv"</span>))</span>
<span id="cb59-280"><a href="#cb59-280" aria-hidden="true" tabindex="-1"></a>DocVis<span class="sc">$</span>visits <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(DocVis<span class="sc">$</span>visits)</span>
<span id="cb59-281"><a href="#cb59-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-282"><a href="#cb59-282" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb59-283"><a href="#cb59-283" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">346</span>)</span>
<span id="cb59-284"><a href="#cb59-284" aria-hidden="true" tabindex="-1"></a>index_tr <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(<span class="at">y =</span> DocVis<span class="sc">$</span>visits, <span class="at">p=</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb59-285"><a href="#cb59-285" aria-hidden="true" tabindex="-1"></a>df_tr <span class="ot">&lt;-</span> DocVis[index_tr,]</span>
<span id="cb59-286"><a href="#cb59-286" aria-hidden="true" tabindex="-1"></a>df_te <span class="ot">&lt;-</span> DocVis[<span class="sc">-</span>index_tr,]</span>
<span id="cb59-287"><a href="#cb59-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-288"><a href="#cb59-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-289"><a href="#cb59-289" aria-hidden="true" tabindex="-1"></a><span class="fu">## Models</span></span>
<span id="cb59-290"><a href="#cb59-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-291"><a href="#cb59-291" aria-hidden="true" tabindex="-1"></a>We will compare a logistic regression, a classification tree (pruned) and a SVM with radial basis (cost and gamma tuned).</span>
<span id="cb59-292"><a href="#cb59-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-293"><a href="#cb59-293" aria-hidden="true" tabindex="-1"></a>:::panel-tabset</span>
<span id="cb59-294"><a href="#cb59-294" aria-hidden="true" tabindex="-1"></a><span class="fu">### R</span></span>
<span id="cb59-295"><a href="#cb59-295" aria-hidden="true" tabindex="-1"></a>Note that the *code for tuning the SVM* is provided below in comments because of the time it takes to run. The final parameters have been selected accordingly. Also, the SVM fit includes the argument <span class="in">`probability=TRUE`</span> to allow the calculations of predicted probabilities later.</span>
<span id="cb59-296"><a href="#cb59-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-299"><a href="#cb59-299" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-300"><a href="#cb59-300" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb59-301"><a href="#cb59-301" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(adabag)</span>
<span id="cb59-302"><a href="#cb59-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-303"><a href="#cb59-303" aria-hidden="true" tabindex="-1"></a><span class="do">## Logistic regression</span></span>
<span id="cb59-304"><a href="#cb59-304" aria-hidden="true" tabindex="-1"></a>Doc_lr <span class="ot">&lt;-</span> <span class="fu">glm</span>(visits<span class="sc">~</span>., <span class="at">data=</span>df_tr, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb59-305"><a href="#cb59-305" aria-hidden="true" tabindex="-1"></a>Doc_lr <span class="ot">&lt;-</span> <span class="fu">step</span>(Doc_lr)</span>
<span id="cb59-306"><a href="#cb59-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-307"><a href="#cb59-307" aria-hidden="true" tabindex="-1"></a><span class="do">## Classification tree </span></span>
<span id="cb59-308"><a href="#cb59-308" aria-hidden="true" tabindex="-1"></a>Doc_ct <span class="ot">&lt;-</span> <span class="fu">autoprune</span>(visits<span class="sc">~</span>., <span class="at">data=</span>df_tr)</span>
<span id="cb59-309"><a href="#cb59-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-310"><a href="#cb59-310" aria-hidden="true" tabindex="-1"></a><span class="do">## SVM radial basis</span></span>
<span id="cb59-311"><a href="#cb59-311" aria-hidden="true" tabindex="-1"></a><span class="co"># grid_radial &lt;- expand.grid(sigma = c(0.0001, 0.001, 0.01, 0.1),</span></span>
<span id="cb59-312"><a href="#cb59-312" aria-hidden="true" tabindex="-1"></a><span class="co">#                           C = c(0.1, 1, 10, 100, 1000))</span></span>
<span id="cb59-313"><a href="#cb59-313" aria-hidden="true" tabindex="-1"></a><span class="co"># trctrl &lt;- trainControl(method = "cv", number=10)</span></span>
<span id="cb59-314"><a href="#cb59-314" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(143)</span></span>
<span id="cb59-315"><a href="#cb59-315" aria-hidden="true" tabindex="-1"></a><span class="co"># Doc_svm &lt;- train(visits ~., data = df_tr, method = "svmRadial",</span></span>
<span id="cb59-316"><a href="#cb59-316" aria-hidden="true" tabindex="-1"></a><span class="co">#                          trControl=trctrl,</span></span>
<span id="cb59-317"><a href="#cb59-317" aria-hidden="true" tabindex="-1"></a><span class="co">#                          tuneGrid = grid_radial)</span></span>
<span id="cb59-318"><a href="#cb59-318" aria-hidden="true" tabindex="-1"></a>Doc_svm <span class="ot">&lt;-</span> <span class="fu">svm</span>(visits<span class="sc">~</span>., <span class="at">data=</span>df_tr, <span class="at">gamma=</span><span class="fl">0.001</span>, <span class="at">cost=</span><span class="dv">1000</span>, <span class="at">probability=</span><span class="cn">TRUE</span>)</span>
<span id="cb59-319"><a href="#cb59-319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-320"><a href="#cb59-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-321"><a href="#cb59-321" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python</span></span>
<span id="cb59-324"><a href="#cb59-324" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb59-325"><a href="#cb59-325" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb59-326"><a href="#cb59-326" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb59-327"><a href="#cb59-327" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb59-328"><a href="#cb59-328" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb59-329"><a href="#cb59-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-330"><a href="#cb59-330" aria-hidden="true" tabindex="-1"></a><span class="co"># We first put the data in a nice format by one-hot encoding the categorical variables</span></span>
<span id="cb59-331"><a href="#cb59-331" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> pd.get_dummies(r.df_tr.drop(<span class="st">'visits'</span>, axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb59-332"><a href="#cb59-332" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> r.df_tr[<span class="st">'visits'</span>]</span>
<span id="cb59-333"><a href="#cb59-333" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> pd.get_dummies(r.df_te.drop(<span class="st">'visits'</span>, axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb59-334"><a href="#cb59-334" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> r.df_te[<span class="st">'visits'</span>]</span>
<span id="cb59-335"><a href="#cb59-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-336"><a href="#cb59-336" aria-hidden="true" tabindex="-1"></a><span class="co">## Logistic regression</span></span>
<span id="cb59-337"><a href="#cb59-337" aria-hidden="true" tabindex="-1"></a>doc_lr <span class="op">=</span> LogisticRegression()</span>
<span id="cb59-338"><a href="#cb59-338" aria-hidden="true" tabindex="-1"></a>doc_lr.fit(X_train, y_train)</span>
<span id="cb59-339"><a href="#cb59-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-340"><a href="#cb59-340" aria-hidden="true" tabindex="-1"></a><span class="co">## Classification tree</span></span>
<span id="cb59-341"><a href="#cb59-341" aria-hidden="true" tabindex="-1"></a>doc_ct <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb59-342"><a href="#cb59-342" aria-hidden="true" tabindex="-1"></a>doc_ct.fit(X_train, y_train)</span>
<span id="cb59-343"><a href="#cb59-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-344"><a href="#cb59-344" aria-hidden="true" tabindex="-1"></a><span class="co">## SVM radial basis</span></span>
<span id="cb59-345"><a href="#cb59-345" aria-hidden="true" tabindex="-1"></a>doc_svm <span class="op">=</span> SVC(kernel<span class="op">=</span><span class="st">'rbf'</span>, gamma<span class="op">=</span><span class="fl">0.001</span>, C<span class="op">=</span><span class="dv">1000</span>, probability<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb59-346"><a href="#cb59-346" aria-hidden="true" tabindex="-1"></a>doc_svm.fit(X_train, y_train)</span>
<span id="cb59-347"><a href="#cb59-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-348"><a href="#cb59-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-349"><a href="#cb59-349" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb59-350"><a href="#cb59-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-351"><a href="#cb59-351" aria-hidden="true" tabindex="-1"></a><span class="fu">## Predictions</span></span>
<span id="cb59-352"><a href="#cb59-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-353"><a href="#cb59-353" aria-hidden="true" tabindex="-1"></a>We now compute the predicted probabilities and the predictions of all the models.</span>
<span id="cb59-354"><a href="#cb59-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-355"><a href="#cb59-355" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb59-356"><a href="#cb59-356" aria-hidden="true" tabindex="-1"></a><span class="fu">## R</span></span>
<span id="cb59-357"><a href="#cb59-357" aria-hidden="true" tabindex="-1"></a>Note that, for SVM, we need to extract the *attribute* "probabilities" from the predicted object. This can be done with the <span class="in">`attr`</span> function.</span>
<span id="cb59-358"><a href="#cb59-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-361"><a href="#cb59-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-362"><a href="#cb59-362" aria-hidden="true" tabindex="-1"></a><span class="do">## Logistic regression</span></span>
<span id="cb59-363"><a href="#cb59-363" aria-hidden="true" tabindex="-1"></a>Doc_lr_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(Doc_lr, <span class="at">newdata=</span>df_te, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb59-364"><a href="#cb59-364" aria-hidden="true" tabindex="-1"></a>Doc_lr_pred <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Doc_lr_prob<span class="sc">&gt;</span><span class="fl">0.5</span>,<span class="st">"Yes"</span>,<span class="st">"No"</span>)</span>
<span id="cb59-365"><a href="#cb59-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-366"><a href="#cb59-366" aria-hidden="true" tabindex="-1"></a><span class="do">## Classification tree </span></span>
<span id="cb59-367"><a href="#cb59-367" aria-hidden="true" tabindex="-1"></a>Doc_ct_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(Doc_ct, <span class="at">newdata=</span>df_te, <span class="at">type=</span><span class="st">"prob"</span>)</span>
<span id="cb59-368"><a href="#cb59-368" aria-hidden="true" tabindex="-1"></a>Doc_ct_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(Doc_ct, <span class="at">newdata=</span>df_te, <span class="at">type=</span><span class="st">"class"</span>)</span>
<span id="cb59-369"><a href="#cb59-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-370"><a href="#cb59-370" aria-hidden="true" tabindex="-1"></a><span class="do">## SVM radial basis</span></span>
<span id="cb59-371"><a href="#cb59-371" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb59-372"><a href="#cb59-372" aria-hidden="true" tabindex="-1"></a>Doc_svm_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(Doc_svm, <span class="at">newdata=</span>df_te, <span class="at">probability=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">attr</span>(<span class="st">"probabilities"</span>)</span>
<span id="cb59-373"><a href="#cb59-373" aria-hidden="true" tabindex="-1"></a>Doc_svm_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(Doc_svm, <span class="at">newdata=</span>df_te, <span class="at">type=</span><span class="st">"class"</span>)</span>
<span id="cb59-374"><a href="#cb59-374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-375"><a href="#cb59-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-376"><a href="#cb59-376" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb59-377"><a href="#cb59-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-380"><a href="#cb59-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb59-381"><a href="#cb59-381" aria-hidden="true" tabindex="-1"></a><span class="co">## Logistic regression</span></span>
<span id="cb59-382"><a href="#cb59-382" aria-hidden="true" tabindex="-1"></a><span class="co">## the second column represents the `no` values, to make sure of that, you can run `doc_lr.classes_`</span></span>
<span id="cb59-383"><a href="#cb59-383" aria-hidden="true" tabindex="-1"></a>doc_lr_prob <span class="op">=</span> doc_lr.predict_proba(X_test)[:,<span class="dv">1</span>]</span>
<span id="cb59-384"><a href="#cb59-384" aria-hidden="true" tabindex="-1"></a>doc_lr_pred <span class="op">=</span> np.where(doc_lr_prob<span class="op">&gt;</span><span class="fl">0.5</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb59-385"><a href="#cb59-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-386"><a href="#cb59-386" aria-hidden="true" tabindex="-1"></a><span class="co">## Classification tree</span></span>
<span id="cb59-387"><a href="#cb59-387" aria-hidden="true" tabindex="-1"></a>doc_ct_prob <span class="op">=</span> doc_ct.predict_proba(X_test)[:,<span class="dv">1</span>]</span>
<span id="cb59-388"><a href="#cb59-388" aria-hidden="true" tabindex="-1"></a>doc_ct_pred <span class="op">=</span> doc_ct.predict(X_test)</span>
<span id="cb59-389"><a href="#cb59-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-390"><a href="#cb59-390" aria-hidden="true" tabindex="-1"></a><span class="co">## SVM radial basis</span></span>
<span id="cb59-391"><a href="#cb59-391" aria-hidden="true" tabindex="-1"></a>doc_svm_prob <span class="op">=</span> doc_svm.predict_proba(X_test)[:,<span class="dv">1</span>]</span>
<span id="cb59-392"><a href="#cb59-392" aria-hidden="true" tabindex="-1"></a>doc_svm_pred <span class="op">=</span> doc_svm.predict(X_test)</span>
<span id="cb59-393"><a href="#cb59-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-394"><a href="#cb59-394" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb59-395"><a href="#cb59-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-396"><a href="#cb59-396" aria-hidden="true" tabindex="-1"></a><span class="fu">## Confusion matrices &amp; prediction-based measures</span></span>
<span id="cb59-397"><a href="#cb59-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-398"><a href="#cb59-398" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb59-399"><a href="#cb59-399" aria-hidden="true" tabindex="-1"></a><span class="fu">### R</span></span>
<span id="cb59-400"><a href="#cb59-400" aria-hidden="true" tabindex="-1"></a>The <span class="in">`confusionMatrix`</span> function provides all the accuracy measures that we want.</span>
<span id="cb59-401"><a href="#cb59-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-404"><a href="#cb59-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-405"><a href="#cb59-405" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data=</span><span class="fu">as.factor</span>(Doc_lr_pred), <span class="at">reference =</span> df_te<span class="sc">$</span>visits)</span>
<span id="cb59-406"><a href="#cb59-406" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data=</span><span class="fu">as.factor</span>(Doc_ct_pred), <span class="at">reference =</span> df_te<span class="sc">$</span>visits)</span>
<span id="cb59-407"><a href="#cb59-407" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data=</span><span class="fu">as.factor</span>(Doc_svm_pred), <span class="at">reference =</span> df_te<span class="sc">$</span>visits)</span>
<span id="cb59-408"><a href="#cb59-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-409"><a href="#cb59-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-410"><a href="#cb59-410" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python</span></span>
<span id="cb59-413"><a href="#cb59-413" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb59-414"><a href="#cb59-414" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, accuracy_score, balanced_accuracy_score, cohen_kappa_score</span>
<span id="cb59-415"><a href="#cb59-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-416"><a href="#cb59-416" aria-hidden="true" tabindex="-1"></a><span class="co">## Logistic regression</span></span>
<span id="cb59-417"><a href="#cb59-417" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confusion_matrix(y_test, doc_lr_pred))</span>
<span id="cb59-418"><a href="#cb59-418" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy: </span><span class="sc">{</span>accuracy_score(y_test, doc_lr_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-419"><a href="#cb59-419" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Kappa: </span><span class="sc">{</span>cohen_kappa_score(y_test, doc_lr_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-420"><a href="#cb59-420" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Balanced accuracy: </span><span class="sc">{</span>balanced_accuracy_score(y_test, doc_lr_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-421"><a href="#cb59-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-422"><a href="#cb59-422" aria-hidden="true" tabindex="-1"></a><span class="co">## Classification tree</span></span>
<span id="cb59-423"><a href="#cb59-423" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confusion_matrix(y_test, doc_ct_pred))</span>
<span id="cb59-424"><a href="#cb59-424" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy: </span><span class="sc">{</span>accuracy_score(y_test, doc_ct_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-425"><a href="#cb59-425" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Kappa: </span><span class="sc">{</span>cohen_kappa_score(y_test, doc_ct_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-426"><a href="#cb59-426" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Balanced accuracy: </span><span class="sc">{</span>balanced_accuracy_score(y_test, doc_ct_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-427"><a href="#cb59-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-428"><a href="#cb59-428" aria-hidden="true" tabindex="-1"></a><span class="co">## SVM radial basis</span></span>
<span id="cb59-429"><a href="#cb59-429" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confusion_matrix(y_test, doc_svm_pred))</span>
<span id="cb59-430"><a href="#cb59-430" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy: </span><span class="sc">{</span>accuracy_score(y_test, doc_svm_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-431"><a href="#cb59-431" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Kappa: </span><span class="sc">{</span>cohen_kappa_score(y_test, doc_svm_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-432"><a href="#cb59-432" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Balanced accuracy: </span><span class="sc">{</span>balanced_accuracy_score(y_test, doc_svm_pred)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-433"><a href="#cb59-433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-434"><a href="#cb59-434" aria-hidden="true" tabindex="-1"></a>Different results for the tree and CSV due to randomness, but even with that, SVM remains the best model in terms of accuracy.</span>
<span id="cb59-435"><a href="#cb59-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-436"><a href="#cb59-436" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb59-437"><a href="#cb59-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-438"><a href="#cb59-438" aria-hidden="true" tabindex="-1"></a>The conclusion may be different from one measure to another</span>
<span id="cb59-439"><a href="#cb59-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-440"><a href="#cb59-440" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Accuracy: the SVM reaches the highest accuracy</span>
<span id="cb59-441"><a href="#cb59-441" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Kappa: the CT is the highest.</span>
<span id="cb59-442"><a href="#cb59-442" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Balanced accuracy: the CT is the highest.</span>
<span id="cb59-443"><a href="#cb59-443" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>etc.</span>
<span id="cb59-444"><a href="#cb59-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-445"><a href="#cb59-445" aria-hidden="true" tabindex="-1"></a>Looking at the confusion matrix, we see that the data is highly unbalanced (many more "No" than "Yes"). Therefore, measures like balanced accuracy and kappa are interesting because they take this characteristics into account. This shows that the CT is probably better than the SVM because it reaches a better balance between predicting "Yes" and "No".</span>
<span id="cb59-446"><a href="#cb59-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-447"><a href="#cb59-447" aria-hidden="true" tabindex="-1"></a>By looking at the sensitivity and specificity (<span class="co">[</span><span class="ot">!! here the positive class is "No"</span><span class="co">]</span>{.underline}), we see that the best model to recover the "No" is the logistic regression (largest sensitivity) and the best model to recover the "Yes" is the classification tree (largest specificity).</span>
<span id="cb59-448"><a href="#cb59-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-449"><a href="#cb59-449" aria-hidden="true" tabindex="-1"></a><span class="fu">## Probability-based measures</span></span>
<span id="cb59-450"><a href="#cb59-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-451"><a href="#cb59-451" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb59-452"><a href="#cb59-452" aria-hidden="true" tabindex="-1"></a><span class="fu">### R</span></span>
<span id="cb59-453"><a href="#cb59-453" aria-hidden="true" tabindex="-1"></a>To compute the AUC (area under the ROC curve) we can use the <span class="in">`caret::twoClassSummary`</span> function. The use of this function can be tricky. Its argument should be a data frame with columns (names are fixed):</span>
<span id="cb59-454"><a href="#cb59-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-455"><a href="#cb59-455" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"obs": the observed classes</span>
<span id="cb59-456"><a href="#cb59-456" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"pred": the predicted classes</span>
<span id="cb59-457"><a href="#cb59-457" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>two columns with names being the levels of the classes, here "Yes" and "No", containing the predicted probabilities.</span>
<span id="cb59-458"><a href="#cb59-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-461"><a href="#cb59-461" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-462"><a href="#cb59-462" aria-hidden="true" tabindex="-1"></a>df_pred_lr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">obs=</span>df_te<span class="sc">$</span>visits,</span>
<span id="cb59-463"><a href="#cb59-463" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Yes=</span>Doc_lr_prob,</span>
<span id="cb59-464"><a href="#cb59-464" aria-hidden="true" tabindex="-1"></a>                         <span class="at">No=</span><span class="dv">1</span><span class="sc">-</span>Doc_lr_prob,</span>
<span id="cb59-465"><a href="#cb59-465" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pred=</span><span class="fu">as.factor</span>(Doc_lr_pred))</span>
<span id="cb59-466"><a href="#cb59-466" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_pred_lr)</span>
<span id="cb59-467"><a href="#cb59-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-468"><a href="#cb59-468" aria-hidden="true" tabindex="-1"></a>df_pred_ct <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">obs=</span>df_te<span class="sc">$</span>visits,</span>
<span id="cb59-469"><a href="#cb59-469" aria-hidden="true" tabindex="-1"></a>                         Doc_ct_prob,</span>
<span id="cb59-470"><a href="#cb59-470" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pred=</span><span class="fu">as.factor</span>(Doc_ct_pred))</span>
<span id="cb59-471"><a href="#cb59-471" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_pred_ct)</span>
<span id="cb59-472"><a href="#cb59-472" aria-hidden="true" tabindex="-1"></a>df_pred_svm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">obs=</span>df_te<span class="sc">$</span>visits,</span>
<span id="cb59-473"><a href="#cb59-473" aria-hidden="true" tabindex="-1"></a>                          Doc_svm_prob,</span>
<span id="cb59-474"><a href="#cb59-474" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pred=</span><span class="fu">as.factor</span>(Doc_svm_pred))</span>
<span id="cb59-475"><a href="#cb59-475" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_pred_svm)</span>
<span id="cb59-476"><a href="#cb59-476" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-477"><a href="#cb59-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-478"><a href="#cb59-478" aria-hidden="true" tabindex="-1"></a>Then we pass these objects to the function, and levels of the classes to be predicted (for the function to be able to recover them in the data frame). The function compute the AUC by default (under the name ROC_.. not very wise) as well as sensitivity and specificity (that we already have).</span>
<span id="cb59-479"><a href="#cb59-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-482"><a href="#cb59-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-483"><a href="#cb59-483" aria-hidden="true" tabindex="-1"></a><span class="fu">twoClassSummary</span>(df_pred_lr, <span class="at">lev =</span> <span class="fu">levels</span>(df_pred_lr<span class="sc">$</span>obs))</span>
<span id="cb59-484"><a href="#cb59-484" aria-hidden="true" tabindex="-1"></a><span class="fu">twoClassSummary</span>(df_pred_ct, <span class="at">lev =</span> <span class="fu">levels</span>(df_pred_lr<span class="sc">$</span>obs))</span>
<span id="cb59-485"><a href="#cb59-485" aria-hidden="true" tabindex="-1"></a><span class="fu">twoClassSummary</span>(df_pred_svm, <span class="at">lev =</span> <span class="fu">levels</span>(df_pred_lr<span class="sc">$</span>obs))</span>
<span id="cb59-486"><a href="#cb59-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-487"><a href="#cb59-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-488"><a href="#cb59-488" aria-hidden="true" tabindex="-1"></a>This brings us another view: the logistic regression has the highest AUC. This shows that varying the prediction threshold provides a good potential of improving the specificity and the sensitivity (in fine, the balanced accuracy).</span>
<span id="cb59-489"><a href="#cb59-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-490"><a href="#cb59-490" aria-hidden="true" tabindex="-1"></a>Now we compute the entropy using the <span class="in">`mnLogLoss`</span> function (entropy is also called *log-loss*).</span>
<span id="cb59-491"><a href="#cb59-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-494"><a href="#cb59-494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-495"><a href="#cb59-495" aria-hidden="true" tabindex="-1"></a><span class="fu">mnLogLoss</span>(df_pred_lr, <span class="at">lev =</span> <span class="fu">levels</span>(df_pred_lr<span class="sc">$</span>obs))</span>
<span id="cb59-496"><a href="#cb59-496" aria-hidden="true" tabindex="-1"></a><span class="fu">mnLogLoss</span>(df_pred_ct, <span class="at">lev =</span> <span class="fu">levels</span>(df_pred_lr<span class="sc">$</span>obs))</span>
<span id="cb59-497"><a href="#cb59-497" aria-hidden="true" tabindex="-1"></a><span class="fu">mnLogLoss</span>(df_pred_svm, <span class="at">lev =</span> <span class="fu">levels</span>(df_pred_lr<span class="sc">$</span>obs))</span>
<span id="cb59-498"><a href="#cb59-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-499"><a href="#cb59-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-500"><a href="#cb59-500" aria-hidden="true" tabindex="-1"></a>Here again, the entropy selects the logistic regression as the best model, though close to classification tree and SVM.</span>
<span id="cb59-501"><a href="#cb59-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-502"><a href="#cb59-502" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python</span></span>
<span id="cb59-503"><a href="#cb59-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-504"><a href="#cb59-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-507"><a href="#cb59-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb59-508"><a href="#cb59-508" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score, roc_curve</span>
<span id="cb59-509"><a href="#cb59-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-510"><a href="#cb59-510" aria-hidden="true" tabindex="-1"></a><span class="co">## Logistic regression</span></span>
<span id="cb59-511"><a href="#cb59-511" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>roc_auc_score(y_test, doc_lr_prob)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-512"><a href="#cb59-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-513"><a href="#cb59-513" aria-hidden="true" tabindex="-1"></a><span class="co">## Classification tree</span></span>
<span id="cb59-514"><a href="#cb59-514" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>roc_auc_score(y_test, doc_ct_prob)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-515"><a href="#cb59-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-516"><a href="#cb59-516" aria-hidden="true" tabindex="-1"></a><span class="co">## SVM radial basis</span></span>
<span id="cb59-517"><a href="#cb59-517" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>roc_auc_score(y_test, doc_svm_prob)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-518"><a href="#cb59-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-519"><a href="#cb59-519" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we compute the entropy using the `log_loss` function (entropy is also called *log-loss*).</span></span>
<span id="cb59-520"><a href="#cb59-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-521"><a href="#cb59-521" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> log_loss</span>
<span id="cb59-522"><a href="#cb59-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-523"><a href="#cb59-523" aria-hidden="true" tabindex="-1"></a><span class="co">## Logistic regression</span></span>
<span id="cb59-524"><a href="#cb59-524" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Log-loss: </span><span class="sc">{</span>log_loss(y_test, doc_lr_prob)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-525"><a href="#cb59-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-526"><a href="#cb59-526" aria-hidden="true" tabindex="-1"></a><span class="co">## Classification tree</span></span>
<span id="cb59-527"><a href="#cb59-527" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Log-loss: </span><span class="sc">{</span>log_loss(y_test, doc_ct_prob)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-528"><a href="#cb59-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-529"><a href="#cb59-529" aria-hidden="true" tabindex="-1"></a><span class="co">## SVM radial basis</span></span>
<span id="cb59-530"><a href="#cb59-530" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Log-loss: </span><span class="sc">{</span>log_loss(y_test, doc_svm_prob)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-531"><a href="#cb59-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-532"><a href="#cb59-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-533"><a href="#cb59-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-534"><a href="#cb59-534" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb59-535"><a href="#cb59-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-536"><a href="#cb59-536" aria-hidden="true" tabindex="-1"></a><span class="fu">## ROC curve &amp; prob threshold tuning</span></span>
<span id="cb59-537"><a href="#cb59-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-538"><a href="#cb59-538" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb59-539"><a href="#cb59-539" aria-hidden="true" tabindex="-1"></a><span class="fu">### R</span></span>
<span id="cb59-540"><a href="#cb59-540" aria-hidden="true" tabindex="-1"></a>To go deeper in the analysis, we now produce the ROC curve of each model using the <span class="in">`roc`</span> function of the <span class="in">`proc`</span> package.</span>
<span id="cb59-541"><a href="#cb59-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-544"><a href="#cb59-544" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-545"><a href="#cb59-545" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb59-546"><a href="#cb59-546" aria-hidden="true" tabindex="-1"></a>ROC_lr <span class="ot">&lt;-</span> <span class="fu">roc</span>(obs <span class="sc">~</span> Yes, <span class="at">data=</span>df_pred_lr)</span>
<span id="cb59-547"><a href="#cb59-547" aria-hidden="true" tabindex="-1"></a>ROC_ct <span class="ot">&lt;-</span> <span class="fu">roc</span>(obs <span class="sc">~</span> Yes, <span class="at">data=</span>df_pred_ct)</span>
<span id="cb59-548"><a href="#cb59-548" aria-hidden="true" tabindex="-1"></a>ROC_svm <span class="ot">&lt;-</span> <span class="fu">roc</span>(obs <span class="sc">~</span> Yes, <span class="at">data=</span>df_pred_svm)</span>
<span id="cb59-549"><a href="#cb59-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-550"><a href="#cb59-550" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ROC_lr, <span class="at">print.thres=</span><span class="st">"best"</span>)</span>
<span id="cb59-551"><a href="#cb59-551" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ROC_ct, <span class="at">print.thres=</span><span class="st">"best"</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb59-552"><a href="#cb59-552" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ROC_svm, <span class="at">print.thres=</span><span class="st">"best"</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb59-553"><a href="#cb59-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-554"><a href="#cb59-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-555"><a href="#cb59-555" aria-hidden="true" tabindex="-1"></a>The plotting function provides an "optimal" threshold that reaches the best trade-off between sensitivity and specificity (according to some criterion). We see that there is room to improve this trade-off.</span>
<span id="cb59-556"><a href="#cb59-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-557"><a href="#cb59-557" aria-hidden="true" tabindex="-1"></a>Now, to tune this threshold, we need to do it *on the training set* to avoid overfitting. To do this, we just repeat the previous calculations (predictions) on the training set. To simplify, we only do this on the logistic regression (note that you can try on the other models; you may find that logistic regression is the best one).</span>
<span id="cb59-558"><a href="#cb59-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-561"><a href="#cb59-561" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-562"><a href="#cb59-562" aria-hidden="true" tabindex="-1"></a>Doc_lr_prob_tr <span class="ot">&lt;-</span> <span class="fu">predict</span>(Doc_lr, <span class="at">newdata=</span>df_tr, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb59-563"><a href="#cb59-563" aria-hidden="true" tabindex="-1"></a>df_pred_lr_tr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">obs=</span>df_tr<span class="sc">$</span>visits,</span>
<span id="cb59-564"><a href="#cb59-564" aria-hidden="true" tabindex="-1"></a>                            <span class="at">Yes=</span>Doc_lr_prob_tr)</span>
<span id="cb59-565"><a href="#cb59-565" aria-hidden="true" tabindex="-1"></a>ROC_lr_tr <span class="ot">&lt;-</span> <span class="fu">roc</span>(obs <span class="sc">~</span> Yes, <span class="at">data=</span>df_pred_lr_tr)</span>
<span id="cb59-566"><a href="#cb59-566" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ROC_lr_tr, <span class="at">print.thres=</span><span class="st">"best"</span>)</span>
<span id="cb59-567"><a href="#cb59-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-568"><a href="#cb59-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-569"><a href="#cb59-569" aria-hidden="true" tabindex="-1"></a>The best threshold is 0.193. Now let us compute the confusion table with this threshold.</span>
<span id="cb59-570"><a href="#cb59-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-571"><a href="#cb59-571" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb59-572"><a href="#cb59-572" aria-hidden="true" tabindex="-1"></a>Doc_lr_pred_opt <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Doc_lr_prob<span class="sc">&gt;</span><span class="fl">0.193</span>,<span class="st">"Yes"</span>,<span class="st">"No"</span>)</span>
<span id="cb59-573"><a href="#cb59-573" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data=</span><span class="fu">as.factor</span>(Doc_lr_pred_opt), <span class="at">reference =</span> df_te<span class="sc">$</span>visits)</span>
<span id="cb59-574"><a href="#cb59-574" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-575"><a href="#cb59-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-576"><a href="#cb59-576" aria-hidden="true" tabindex="-1"></a>We now have a model with an accuracy of circa $70\%$ but with a balanced accuracy of $67\%$. Far from perfect, this is still an interesting improvement compare to the CT $62\%$. The specificity and sensitivity are now respectively $62\%$ and $72\%$. The specificity in particular made a huge improvement (from around $29\%$ at best - by CT - to $62\%$ - by log. reg).</span>
<span id="cb59-577"><a href="#cb59-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-578"><a href="#cb59-578" aria-hidden="true" tabindex="-1"></a>If the aim is to predict both "Yes" and "No", this last model (log. reg. with tuned threshold) is the best one to use.</span>
<span id="cb59-579"><a href="#cb59-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-580"><a href="#cb59-580" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python</span></span>
<span id="cb59-581"><a href="#cb59-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-584"><a href="#cb59-584" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb59-585"><a href="#cb59-585" aria-hidden="true" tabindex="-1"></a><span class="co">## Logistic regression</span></span>
<span id="cb59-586"><a href="#cb59-586" aria-hidden="true" tabindex="-1"></a><span class="co">## We need to turn back our results into binary values to be plotted</span></span>
<span id="cb59-587"><a href="#cb59-587" aria-hidden="true" tabindex="-1"></a>doc_lr_prob_dict <span class="op">=</span> {<span class="st">'Yes'</span>: <span class="dv">1</span>, <span class="st">'No'</span>: <span class="dv">0</span>}</span>
<span id="cb59-588"><a href="#cb59-588" aria-hidden="true" tabindex="-1"></a>y_test_binary <span class="op">=</span> np.array([doc_lr_prob_dict[x] <span class="cf">for</span> x <span class="kw">in</span> y_test])</span>
<span id="cb59-589"><a href="#cb59-589" aria-hidden="true" tabindex="-1"></a>fpr_lr, tpr_lr, thresholds_lr <span class="op">=</span> roc_curve(y_test_binary, doc_lr_prob)</span>
<span id="cb59-590"><a href="#cb59-590" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr_lr, tpr_lr, label<span class="op">=</span><span class="st">"Logistic Regression"</span>)</span>
<span id="cb59-591"><a href="#cb59-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-592"><a href="#cb59-592" aria-hidden="true" tabindex="-1"></a><span class="co">## Classification tree</span></span>
<span id="cb59-593"><a href="#cb59-593" aria-hidden="true" tabindex="-1"></a>doc_ct_prob_dict <span class="op">=</span> {<span class="st">'Yes'</span>: <span class="dv">1</span>, <span class="st">'No'</span>: <span class="dv">0</span>}</span>
<span id="cb59-594"><a href="#cb59-594" aria-hidden="true" tabindex="-1"></a>y_test_binary <span class="op">=</span> np.array([doc_ct_prob_dict[x] <span class="cf">for</span> x <span class="kw">in</span> y_test])</span>
<span id="cb59-595"><a href="#cb59-595" aria-hidden="true" tabindex="-1"></a>fpr_ct, tpr_ct, thresholds_ct <span class="op">=</span> roc_curve(y_test_binary, doc_ct_prob)</span>
<span id="cb59-596"><a href="#cb59-596" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr_ct, tpr_ct, label<span class="op">=</span><span class="st">"Classification Tree"</span>)</span>
<span id="cb59-597"><a href="#cb59-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-598"><a href="#cb59-598" aria-hidden="true" tabindex="-1"></a><span class="co">## SVM radial basis</span></span>
<span id="cb59-599"><a href="#cb59-599" aria-hidden="true" tabindex="-1"></a>doc_svm_prob_dict <span class="op">=</span> {<span class="st">'Yes'</span>: <span class="dv">1</span>, <span class="st">'No'</span>: <span class="dv">0</span>}</span>
<span id="cb59-600"><a href="#cb59-600" aria-hidden="true" tabindex="-1"></a>y_test_binary <span class="op">=</span> np.array([doc_svm_prob_dict[x] <span class="cf">for</span> x <span class="kw">in</span> y_test])</span>
<span id="cb59-601"><a href="#cb59-601" aria-hidden="true" tabindex="-1"></a>fpr_svm, tpr_svm, thresholds_svm <span class="op">=</span> roc_curve(y_test_binary, doc_svm_prob)</span>
<span id="cb59-602"><a href="#cb59-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-603"><a href="#cb59-603" aria-hidden="true" tabindex="-1"></a><span class="co"># Clear the last plot (if any)</span></span>
<span id="cb59-604"><a href="#cb59-604" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.clf()</span></span>
<span id="cb59-605"><a href="#cb59-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-606"><a href="#cb59-606" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr_svm, tpr_svm, label<span class="op">=</span><span class="st">"SVM Radial Basis"</span>)</span>
<span id="cb59-607"><a href="#cb59-607" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the ROC curve</span></span>
<span id="cb59-608"><a href="#cb59-608" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">"Random Classifier"</span>)</span>
<span id="cb59-609"><a href="#cb59-609" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb59-610"><a href="#cb59-610" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb59-611"><a href="#cb59-611" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC Curve"</span>)</span>
<span id="cb59-612"><a href="#cb59-612" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb59-613"><a href="#cb59-613" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb59-614"><a href="#cb59-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-615"><a href="#cb59-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-616"><a href="#cb59-616" aria-hidden="true" tabindex="-1"></a>We can then plot the results in the similar way to R:</span>
<span id="cb59-617"><a href="#cb59-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-620"><a href="#cb59-620" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb59-621"><a href="#cb59-621" aria-hidden="true" tabindex="-1"></a>doc_lr_prob_tr <span class="op">=</span> doc_lr.predict_proba(X_train)[:,<span class="dv">1</span>]</span>
<span id="cb59-622"><a href="#cb59-622" aria-hidden="true" tabindex="-1"></a>doc_lr_prob_tr_dict <span class="op">=</span> {<span class="st">'Yes'</span>: <span class="dv">1</span>, <span class="st">'No'</span>: <span class="dv">0</span>}</span>
<span id="cb59-623"><a href="#cb59-623" aria-hidden="true" tabindex="-1"></a>y_train_binary <span class="op">=</span> np.array([doc_lr_prob_tr_dict[x] <span class="cf">for</span> x <span class="kw">in</span> y_train])</span>
<span id="cb59-624"><a href="#cb59-624" aria-hidden="true" tabindex="-1"></a>fpr_lr_tr, tpr_lr_tr, thresholds_lr_tr <span class="op">=</span> roc_curve(y_train_binary, doc_lr_prob_tr)</span>
<span id="cb59-625"><a href="#cb59-625" aria-hidden="true" tabindex="-1"></a>optimal_idx <span class="op">=</span> np.argmax(tpr_lr_tr <span class="op">-</span> fpr_lr_tr)</span>
<span id="cb59-626"><a href="#cb59-626" aria-hidden="true" tabindex="-1"></a>optimal_threshold <span class="op">=</span> thresholds_lr_tr[optimal_idx]</span>
<span id="cb59-627"><a href="#cb59-627" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Optimal threshold: </span><span class="sc">{</span>optimal_threshold<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb59-628"><a href="#cb59-628" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-629"><a href="#cb59-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-630"><a href="#cb59-630" aria-hidden="true" tabindex="-1"></a>Finally, we print the confusion matrix again:</span>
<span id="cb59-631"><a href="#cb59-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-634"><a href="#cb59-634" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb59-635"><a href="#cb59-635" aria-hidden="true" tabindex="-1"></a>doc_lr_pred_opt <span class="op">=</span> np.where(doc_lr_prob <span class="op">&gt;</span> optimal_threshold, <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb59-636"><a href="#cb59-636" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confusion_matrix(y_test, doc_lr_pred_opt))</span>
<span id="cb59-637"><a href="#cb59-637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-638"><a href="#cb59-638" aria-hidden="true" tabindex="-1"></a>The logistic regression produced with R was better.</span>
<span id="cb59-639"><a href="#cb59-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-640"><a href="#cb59-640" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb59-641"><a href="#cb59-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-642"><a href="#cb59-642" aria-hidden="true" tabindex="-1"></a><span class="fu"># Your turn</span></span>
<span id="cb59-643"><a href="#cb59-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-644"><a href="#cb59-644" aria-hidden="true" tabindex="-1"></a><span class="fu">## Classification</span></span>
<span id="cb59-645"><a href="#cb59-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-646"><a href="#cb59-646" aria-hidden="true" tabindex="-1"></a>Repeat the analysis on the German credit data. Put several models in competition. Tune them and try to optimize their threshold. Select the best one and analyze its performance.</span>
<span id="cb59-647"><a href="#cb59-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-648"><a href="#cb59-648" aria-hidden="true" tabindex="-1"></a><span class="fu">## Regression</span></span>
<span id="cb59-649"><a href="#cb59-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-650"><a href="#cb59-650" aria-hidden="true" tabindex="-1"></a>Repeat the analysis on the nursing cost data. Put several models in competition. Tune them and select the best one. Analyze its performance using a scatterplot.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">© Copyright 2024, <a href="https://iliaazizi.com/">Ilia Azizi &amp; Marc-Olivier Boldi</a></div>   
    <div class="nav-footer-right">This page is built with 🤍 and <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>